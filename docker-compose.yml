version: '3.8'

services:
  folio:
    # Use the pre-built image from GitHub Container Registry
    image: ghcr.io/americanhowl/folio:latest
    container_name: folio
    ports:
      - "9099:9099"
    volumes:
      # Mount your Calibre library - REQUIRED: Update this path!
      # Use :rw (read-write) to allow metadata editing via calibredb
      - ${CALIBRE_LIBRARY:-/data/calibre-library}:/data/calibre-library:rw
      # OPTIONAL: Mount an import folder for automatic book imports
      # Books placed here will be automatically added to Calibre
      # - ${IMPORT_FOLDER:-/data/import}:/data/import:ro
    environment:
      # Calibre Library location inside container (must match volume mount)
      - CALIBRE_LIBRARY=/data/calibre-library
      # calibredb executable path (set explicitly for container)
      - CALIBREDB_PATH=/usr/bin/calibredb
      # Hardcover API token (get from https://hardcover.app/account/api)
      - HARDCOVER_TOKEN=${HARDCOVER_TOKEN:-}
      # Prowlarr address (e.g., http://prowlarr:9696 or http://localhost:9696)
      - PROWLARR_URL=${PROWLARR_URL:-}
      # Prowlarr API key (get from Prowlarr Settings → General → API Key)
      - PROWLARR_API_KEY=${PROWLARR_API_KEY:-}
      # qBittorrent Web UI address (e.g., http://qbittorrent:8080 or http://localhost:8080)
      - QBITTORRENT_URL=${QBITTORRENT_URL:-}
      # qBittorrent Web UI username (if authentication enabled)
      - QBITTORRENT_USERNAME=${QBITTORRENT_USERNAME:-}
      # qBittorrent Web UI password (if authentication enabled)
      - QBITTORRENT_PASSWORD=${QBITTORRENT_PASSWORD:-}
      # OPTIONAL: Import folder settings (uncomment volume mount above to use)
      # - IMPORT_FOLDER=/data/import          # Path inside container
      # - IMPORT_INTERVAL=60                  # Scan interval in seconds (default: 60)
      # - IMPORT_RECURSIVE=true               # Scan subdirectories (default: true)
      # - IMPORT_DELETE=false                 # Delete originals after import (default: false, copies instead)
    # DNS servers for reliable hostname resolution (fixes "Temporary failure in name resolution")
    dns:
      - 8.8.8.8
      - 8.8.4.4
      - 1.1.1.1
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9099/api/config"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped
